function onYouTubePlayerAPIReady(){YT_ready(!0)}function getFrameID(e){var t=document.getElementById(e);if(t){if(/^iframe$/i.test(t.tagName))return e;var n=t.getElementsByTagName("iframe");if(!n.length)return null;for(var r=0;r<n.length;r++)if(/^https?:\/\/(?:www\.)?youtube(?:-nocookie)?\.com(\/|$)/i.test(n[r].src))break;t=n[r];if(t.id)return t.id;do e+="-frame";while(document.getElementById(e));t.id=e;return e}return null}function setup_players(){$(".participant-video-embed").each(function(){var e=this.id,t=getFrameID(e);if(t){players[t]=new YT.Player(t,{events:{onStateChange:onStateChange(t,e),onReady:onReady(t,e)}});$("#"+t).bind("player_ready",videoSetTimer);$("#"+t).bind("player_ready",setup_position_slider);$("#"+t).bind("player_ready",setup_volume_slider);$("#"+t).bind("player_ready",autoplay_video);$("#"+t).bind("player_start_play_buffer",videoSetTimer);$("#"+t).bind("player_start_play_buffer",enable_taggable_area);$("#"+t).bind("player_start_play_buffer",display_taggable_area);$("#"+t).bind("player_start_play_buffer",toggle_play_pause_button);$("#"+t).bind("player_pause_end",toggle_play_pause_button);$("#"+t).bind("player_time_update",videoUpdateTimer);$("#"+t).bind("player_time_update",videoUpdatePosition);$("#"+t).bind("player_time_update",autoShowComment)}})}function onStateChange(e,n){return function(n){var r=players[e];switch(n.data){case 1:case 3:$("#"+e).trigger("player_start_play_buffer");t=setInterval(function(){playerTimeUpdate(e)},500);break;case 2:case 0:$("#"+e).trigger("player_pause_end");clearTimeout(t)}}}function onReady(e,t){return function(t){var n=players[e],r=!n.cueVideoByFlashvars;r&&!n.getDuration();$("#"+e).trigger("player_ready")}}function playerTimeUpdate(e){$("#"+e).trigger("player_time_update")}function videoUpdatePosition(e){var t=players[e.currentTarget.id],n=$("#"+e.currentTarget.id).siblings(".participant-video-controls").find(".control-slider");$(n).slider("value",t.getCurrentTime()/t.getDuration()*1e3)}function autoShowComment(e){var t=$("#"+e.currentTarget.id).siblings(".participant-video-controls").find(".control-slider"),n=parseInt($(t).width()*((t.slider("value")+1)/1e3),10),r=$("#marker-"+n);r.length&&$("#taggable-area").setupPopover().showPopover(n)}function videoUpdateTimer(e){var t=players[e.currentTarget.id],n=parseInt(t.getCurrentTime()/60,10)%60,r=parseInt(t.getCurrentTime()%60,10);$(".control-time-current .time-m").text(n);$(".control-time-current .time-s").text(r)}function videoSetTimer(e){var t=players[e.currentTarget.id],n=parseInt(t.getDuration()/60,10)%60,r=parseInt(t.getDuration()%60,10);$(".control-time-total .time-m").text(n);$(".control-time-total .time-s").text(r)}function enable_taggable_area(){$("#taggable-area").click(function(e){if(!$("body").hasClass("logged-in")){$(this).popover("hide");return!1}var t=parseInt(e.pageX-$(this).offset().left,10);$(this).setupPopover().showPopover(t)})}function setup_popover(){$("#taggable-area").setupPopover()}function add_comment_to_marker_box(e,t){var n=$("#marker-"+e);n.length?$(n).find(".content").prepend(t):$(".clip-markers").append('<a class="marker" id="marker-'+e+'" style="left: '+e+'px"><div class="arrow"></div><div class="hide content">'+t+"</div></div>")}function display_taggable_area(e){$("#taggable-area").each(function(){$(this).show().find("span").each(function(){$(this).show().fadeTo(0,1).delay(1e3).fadeTo("slow",.3,function(){$(this).removeAttr("style")})})});$(".clip-markers").show()}function toggle_play_pause_button(e){var t=players[e.currentTarget.id];switch(t.getPlayerState()){case 1:$(".play-pause").attr("data-control","pause").find("span").removeClass("icon-play").addClass("icon-pause");break;case 2:$(".play-pause").attr("data-control","play").find("span").removeClass("icon-pause").addClass("icon-play")}}function setup_position_slider(e){var t=$("#"+e.currentTarget.id).siblings(".participant-video-controls").find(".control-slider").slider({range:"min",min:0,max:1e3});$(t).on("slidestart",function(e,t){var n=$(this).closest(".participant-clip").find(".participant-video-embed").attr("id");$("#"+n).unbind("player_time_update",videoUpdatePosition)});$(t).on("slidestop",function(e,t){var n=$(this).closest(".participant-clip").find(".participant-video-embed").attr("id");players[n].seekTo(Math.round(players[n].getDuration()*(t.value/1e3)*100)/100,!0);$("#"+n).bind("player_time_update",videoUpdatePosition)})}function setup_volume_slider(e){var t=players[e.currentTarget.id],n=$("#"+e.currentTarget.id).siblings(".participant-video-controls").find(".volume-slider").slider({orientation:"vertical",range:"min",min:0,max:100,value:t.getVolume()});$(n).on("slide",function(e,n){t.setVolume(n.value)})}function turn_out_the_lights(){$("#shadow").length?$("#shadow").remove():$("body").append('<div id="shadow"></div>')}function autoplay_video(e){players[e.currentTarget.id].playVideo()}$(function(){$(window).bind("setup_players",setup_players);$(window).bind("setup_players",setup_popover);$(".controls").live("click",function(){var e=$(this).closest(".participant-clip").find(".participant-video-embed").attr("id"),t=players[e],n=$(this).attr("data-control");switch(n){case"play":players[e].playVideo();break;case"pause":players[e].pauseVideo();break;case"fullscreen":var r=document.getElementById(e);r.requestFullScreen?r.requestFullScreen():r.mozRequestFullScreen?r.mozRequestFullScreen():r.webkitRequestFullScreen&&r.webkitRequestFullScreen();break;case"comments":$(".clip-markers").toggle();break;case"dimmer":turn_out_the_lights()}});$(document).on("click",".popover .close",function(){$(this).closest(".popover").prev().popover("hide")});$(document).on("submit",".popover form",function(){$(this).find(".error").fadeOut("slow",function(){$(this).remove()});$.post(glpAjax.ajaxurl,{action:"clip_submit_comment",comment:$(this).find('input[name="comment"]').val(),minutes:$("#taggable-area").data("m"),seconds:$("#taggable-area").data("s"),position:$("#taggable-area").data("p"),post_id:$(".participant-video-embed").attr("id").replace("participant-video-embed-","")},function(e){r=$.parseJSON(e);$(".comment-box").prepend(r.message).closest("form").find("input").val("");r.success&&add_comment_to_marker_box(r.success,r.message);$(".popover").fixPopoverHeight()});return!1});$(document).on("click","#shadow",function(){turn_out_the_lights()});$(document).on("mouseenter",".marker",function(e){var t=parseInt($(this).attr("id").replace("marker-",""),10);$("#taggable-area").setupPopover().showPopover(t)});$(document).on("mouseleave",".marker",function(e){});$(document).on("click",".participant-clip-listing .clip-thumbnail",function(){$("html, body").scrollTop(0);var e=$(this).data("clip-id");$(this).parents(".participant-clip-listing").addClass("active").siblings().removeClass("active");$("#stage").slideUp().load("/wp/wp-admin/admin-ajax.php",{action:"get_participant_clip",clip_id:e},function(){$("#stage").delay(250).slideDown();$(window).trigger("setup_players")})});$(document).on("click",".btn-toggle",function(){var e=$(this).data("user-id"),t=$(this).data("clip-id"),n=$(this).data("toggle-type");$(this).load(glpAjax.ajaxurl,{action:"toggle_clip",user_id:e,clip_id:t,toggle_type:n},function(e){$("[data-clip-id='"+t+"'][data-toggle-type='"+n+"']").html(e)});return!1});$(document).on("click",".btn-toggle-all",function(){var e=$(this).data("user-id"),t=$(this).data("list-id");$.post(glpAjax.ajaxurl,{action:"toggle_clip_list",user_id:e,post_id:t},function(n){response=$.parseJSON(n);$("[data-list-id='"+t+"'][data-user-id='"+e+"']").html(response.text);for(var r in response.toggled){clip_id=response.toggled[r];$.post(glpAjax.ajaxurl,{action:"clip_status",user_id:e,clip_id:clip_id},function(e){e=$.parseJSON(e);$("[data-clip-id='"+e.clip_id+"'][data-toggle-type='queue']").html(e.status)})}});return!1})});var players={},t;(function(){var e=document.createElement("script");e.src=(location.protocol=="https:"?"https":"http")+"://www.youtube.com/player_api";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})();var YT_ready=function(){var e=[],t=!1;return function(n,r){if(n===!0){t=!0;while(e.length)e.shift()()}else typeof n=="function"&&(t?n():e[r?"unshift":"push"](n))}}();YT_ready(function(){$(window).trigger("setup_players")});$.fn.setupPopover=function(){var e=this.next().find(".content").html(),t=this.next().find(".title").html();this.popover({html:!0,animation:!1,content:e,title:t});return this};$.fn.showPopover=function(e){var t=this.closest(".participant-clip").find(".participant-video-embed").attr("id"),n=players[t],r=e/this.width(),i=Math.round(n.getDuration()*r*100)/100,s=parseInt(i/60,10)%60,o=parseInt(i%60,10);this.data("m",s).data("s",o).data("p",e);this.popover("show");var u=this.next(),a=e-u.width()/2;$(u).find(".comment-box").prepend($("#marker-"+e+" .content").html());$(u).css("left",a).find(".time").text(s+":"+o);$(u).fixPopoverHeight();return this};$.fn.fixPopoverHeight=function(){this.css("top",0-this.height()-20);return this};