$(function(){function e(e,t){var n="rgba(0,0,0,0)",r="rgba(0,0,0,0)";if(t){n=t.from?t.from:n;r=t.to?t.to:r}var i=new Image;i.src=e;i.onload=function(){var e="-webkit-linear-gradient("+n+" 0, "+r+" "+this.height+"px)",t="url("+this.src+")";i.src&&$("#wrap").css("background-image",e+", "+t)}}function t(e){$("#stage").fadeOut().load("/wp/wp-admin/admin-ajax.php",{action:"get_participant_summary",post_id:e}).fadeIn()}function n(e,t){var n=$(t).position().top-50,r=$(t).position().left+25;$("#popover").css("top",n).css("left",r);$("#popover .popover-name").text(e.name);$("#popover .popover-location").text(e.location);$("#popover .popover-occupation").text(e.occupation);$("#popover .popover-dob").text(e.dob);$("#popover .popover-thumbnail").attr("src",e.thumbnail);$("#popover .popover-permalink").attr("href",e.permalink);$("#popover").show()}function r(e){$(".mapthumb").hide();$("#mapthumb-"+e).show()}$("#nav-main").affix({offset:$("#nav-main").position()});$("body:not(.home)").length&&$("body,html").scrollTop($("#nav-main").offset().top);$(".carousel").carousel("pause");$("#nav-featured .participant-thumbnail").click(function(){$(this).siblings().removeClass("active");$(this).addClass("active");$("#home").fadeOut();t($(this).data("id"))});$("#nav-featured .home-thumbnail").click(function(){$("#stage").fadeOut("",function(){$("#home").fadeIn()})});if($(".front-page").length){var i=$(".front-page").data("bg");e(i)}if($("#mapview").length){var s=d3.geo.mercator().scale($("#mapview").width()).translate([$("#mapview").width()/2,$("#mapview").height()/1.75]),o=d3.geo.path().projection(s),u=d3.select("#mapview").append("svg:svg").attr("height","100%").attr("width","100%"),a=u.append("svg:defs"),f=u.append("svg:g").attr("id","countries"),l=u.append("svg:g").attr("id","cells"),c=u.append("svg:g").attr("id","locations"),h=[];participants=participants.filter(function(e){var t=[+e.longitude,+e.latitude];h.push(s(t));return!0});var p=a.selectAll("thumbnails").data(participants).enter().append("svg:pattern").attr("id",function(e,t){return"image-"+t}).attr("patternUnits","objectBoundingBox").attr("width",50).attr("height",50).append("svg:image").attr("xlink:href",function(e){return e.thumbnail}).attr("x",0).attr("y",0).attr("width",50).attr("height",50),d=d3.geom.voronoi(h),v=l.selectAll("g").data(participants).enter().append("svg:g").attr("opacity",0);v.append("svg:path").attr("d",function(e,t){return"M"+d[t].join("L")+"Z"}).on("mouseover",function(e,t){r(t)});var m=c.selectAll("marker").data(participants).enter().append("svg:g").attr("class",function(e){return"marker "+e.continent}).attr("transform",function(e){return"translate("+s([+e.longitude,+e.latitude])+")"}).on("click",function(e){n(e,this)});m.append("svg:path").attr("class","pin").attr("d","M240,80c-60,0-107,48-107,107c0,25,9,49,24,67 c18,22,56,42,64,131c0,5,3,16,19,16c16,0,19-11,20-16 c8-88,46-108,64-131c15-18,24-42,24-67C347,127,299,80,240,80z M238,221c-19,0-35-15-35-35c0-19,15-35,35-35 c19,0,35,15,35,35C273,206,257,221,238,221z").attr("transform","translate(-30,-50), scale(0.125)");m.append("svg:circle").attr("id",function(e,t){return"mapthumb-"+t}).attr("class","mapthumb").attr("cy",-40).attr("r",25).attr("fill",function(e,t){return"url(#image-"+t+")"});d3.json("/content/themes/glp/js/vendor/countries.json",function(e){f.selectAll("path").data(e.features).enter().append("svg:path").attr("d",o)});d3.json("/content/themes/glp/js/vendor/countries-hires.json",function(e){f.selectAll("path").remove();f.selectAll("path").data(e.features).enter().append("svg:path").attr("d",o)})}$("#popover").hide();$("#popover .close").click(function(){$(this).parent().hide()});$(".participant-clip .clip-thumbnail").click(function(){var e=$(this).data("clip-id");$("#stage").fadeOut().load("/wp/wp-admin/admin-ajax.php",{action:"get_participant_clip",clip_id:e},function(){$(this).addClass("active");$("#stage").fadeIn()})});if($(".blog").length){var g=$(".blog .post").first().data("bg");g&&e(g,{to:"#262626"});$(".past-posts-container .post").each(function(){var e=$(this).data("bg");e&&$(this).css("background-image","url("+e+")")})}});