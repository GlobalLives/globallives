$(function(){$("a:has(img)").addClass("image-link");d($("#nav-modules .widget"));function h(t,q){var s="rgba(0,0,0,0)",u="rgba(0,0,0,0)",r=new Image();if(q){s=q.from?q.from:s;u=q.to?q.to:u}r.src=t;r.onload=function(){var v="("+s+" 0, "+u+" "+this.height+"px)";var w="url("+this.src+")";if(r.src){$("#wrap").css("background-image","-webkit-linear-gradient"+v+", "+w);$("#wrap").css("background-image","-moz-linear-gradient"+v+", "+w);$("#wrap").css("background-image","linear-gradient"+v+", "+w)}}}function g(q){$("#stage").fadeOut("slow").load("/wp/wp-admin/admin-ajax.php",{action:"get_participant_summary",post_id:q},function(){$("#stage").fadeIn("slow")})}function b(u,t){var s=$("#mapview").width(),q=$(t).position().top,r=$(t).position().left;if(r<s/2){dx_offset=30}else{dx_offset=-340}$("#popover").css("top",q).css("left",r+dx_offset);$("#popover .popover-name").text(u.name);$("#popover .popover-location").text(u.location);$("#popover .popover-occupation").text(u.occupation);$("#popover .popover-series").html(u.series);$("#popover .popover-thumbnail").attr("src",u.thumbnail);$("#popover .popover-permalink").attr("href",u.permalink);$("#popover, .overlay").show()}function e(q){$(".mapthumb").hide();$("#mapthumb-"+q).show()}function d(r){var q=0;r.each(function(){var s=$(this).height();if(s>q){q=s}});r.height(q)}if($("body.page-home").length){$(".carousel").carousel("pause");$("#featured-carousel").bind("slide",function(){$("#featured-carousel").css("overflow","hidden")});$("#featured-carousel").bind("slid",function(){$("#featured-carousel").css("overflow","visible")});$("#nav-featured .participant-thumbnail").click(function(){$(".home-thumbnail, .participant-thumbnail").removeClass("active");$(this).addClass("active");$("#home").fadeOut("slow");g($(this).data("id"))});$("#nav-featured .home-thumbnail").click(function(){$("#stage").fadeOut("slow",function(){$(".participant-thumbnail").removeClass("active");$(".home-thumbnail").addClass("active");$("#home").fadeIn("slow")})})}if($("body.page-explore").length){$(".btn-mapview").click(function(){$(this).addClass("active").siblings().removeClass("active");$(".view").slideUp(500,function(){$("#mapview").delay(700).slideDown(500)})});$(".btn-gridview").click(function(){$(this).addClass("active").siblings().removeClass("active");$(".view").slideUp(500,function(){$("#gridview").delay(700).slideDown(500)})});$("#nav-explore input, #nav-explore select").change(function(){$(participants).each(function(){this.filtered=false;if($("select[name=series]").val()!=="All"&&this.series!==$("select[name=series]").val()){this.filtered=true}if($("select[name=gender]").val()!=="All"&&this.gender!==$("select[name=gender]").val()){this.filtered=true}if($("select[name=income]").val()!=="All"&&this.income!==$("select[name=income]").val()){this.filtered=true}if($("select[name=age]").val()!=="All"&&this.age!==$("select[name=age]").val()){this.filtered=true}if(!$("input[name=proposed]:checked").val()&&this.proposed){this.filtered=true}if(this.filtered===true){$("#participant-"+this.id).addClass("filtered");d3.selectAll("#marker-"+this.id).classed("filtered",true)}else{$("#marker-"+this.id+", #participant-"+this.id).removeClass("filtered");d3.selectAll("#marker-"+this.id).classed("filtered",false)}});$(".participant-grid").hide();$(".participant-grid:not(.filtered)").fadeIn();return false})}if($("#mapview").length){$("#mapview").hide();var m=$("#mapview").height(),c=$("#mapview").width();var k=d3.geo.mercator().scale(c*0.16).translate([c/2,m/1.75]);var p=d3.geo.path().projection(k);var o=d3.behavior.zoom().translate(k.translate()).scale(k.scale()).scaleExtent([c*0.15,8*m]).on("zoom",function(){k.translate(d3.event.translate).scale(d3.event.scale);n.selectAll("path").attr("d",p);a.selectAll(".marker").attr("transform",function(q){return"translate("+k([+q.longitude,+q.latitude])+")"})});var a=d3.select("#mapview").append("svg").attr("height",m).attr("width",c);var n=a.append("g").attr("id","countries").call(o);n.append("rect").attr("class","background").attr("height",m).attr("width",c);var f=a.append("defs").selectAll("thumbnails").data(participants).enter().append("pattern").attr("id",function(r,q){return"image-"+q}).attr("patternUnits","objectBoundingBox").attr("width",50).attr("height",50).append("image").attr("xlink:href",function(q){return q.thumbnail}).attr("x",0).attr("y",0).attr("width",50).attr("height",50);var j=a.selectAll(".marker").data(participants).enter().append("g").attr("id",function(q){return"marker-"+q.id}).attr("class",function(q){return"marker "+q.continent}).attr("transform",function(q){return"translate("+k([+q.longitude,+q.latitude])+")"}).on("click",function(q){b(q,this)});j.append("path").attr("class","pin").attr("d","M240,80c-60,0-107,48-107,107c0,25,9,49,24,67 c18,22,56,42,64,131c0,5,3,16,19,16c16,0,19-11,20-16 c8-88,46-108,64-131c15-18,24-42,24-67C347,127,299,80,240,80z M238,221c-19,0-35-15-35-35c0-19,15-35,35-35 c19,0,35,15,35,35C273,206,257,221,238,221z").attr("transform","translate(-30,-50), scale(0.125)");j.append("circle").attr("class","mapthumb").attr("id",function(r,q){return"mapthumb-"+q}).attr("r",25).attr("cy",-25).attr("fill",function(r,q){return"url(#image-"+q+")"});var l=j.append("text").attr("class","label").attr("dx",-25).attr("dy",18);l.append("tspan").attr("class","name").text(function(q){return q.name});l.append("tspan").attr("class","location").text(function(q){return q.location}).attr("x",-25).attr("dy",18);l.append("tspan").attr("class","occupation").text(function(q){return q.occupation}).attr("x",-25).attr("dy",18);d3.json("/content/themes/glp/js/vendor/countries.json",function(q){n.selectAll("path").data(q.features).enter().append("svg:path").attr("d",p)});$(".overlay, .mapthumb, .label, #popover").hide();$(".marker").mouseover(function(){$(".mapthumb, .label").hide();$(this).find(".mapthumb, .label").show()});$(".overlay, #popover .close").click(function(){$("#popover, .overlay").hide()});$(".background").click(function(){$(".mapthumb, .label").hide()})}$(".participant-clip-listing .clip-thumbnail").click(function(){$("html, body").scrollTop(0);var q=$(this).data("clip-id");$(this).parents(".participant-clip-listing").addClass("active").siblings().removeClass("active");$("#stage").slideUp().load("/wp/wp-admin/admin-ajax.php",{action:"get_participant_clip",clip_id:q},function(){$("#stage").delay(250).slideDown();$(window).trigger("setup_players")})});if($(".blog").length){var i=$(".blog .post").first().data("bg");if(i){h(i,{to:"#262626"})}$(".past-posts .post").each(function(){var q=$(this).data("bg");if(q){$(this).css("background-image","url("+q+")")}})}if($(".events-list").length){$(".tribe-events-event").each(function(){var q=$(this).data("bg");if(q){$(this).css("background-image","url("+q+")")}})}$(".search-sidebar :checkbox").change(function(){var q=$(this).val();$(".search-result."+q).slideToggle("",function(){$(".results-found").html($(".search-result:visible").length)})});if($("body.tax-series").length){$(".carousel").carousel("pause");$("#series-carousel").bind("slide",function(){$("#series-carousel").css("overflow","hidden")});$("#series-carousel").bind("slid",function(){$("#series-carousel").css("overflow","visible")});$("#nav-series .participant-thumbnail").click(function(){$("#home").fadeOut("slow");g($(this).data("id"))});$("#nav-series .home-thumbnail").click(function(){$("#stage").fadeOut("slow",function(){$("#home").fadeIn("slow")})});$(".btn-mapview").click(function(){$("#mapview").slideToggle(500)})}});