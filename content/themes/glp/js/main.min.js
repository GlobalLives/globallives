$(function(){$("a:has(img)").addClass("image-link");function h(v,g){var u="rgba(0,0,0,0)",w="rgba(0,0,0,0)",s=new Image();if(g){u=g.from?g.from:u;w=g.to?g.to:w}s.src=v;s.onload=function(){var x="("+u+" 0, "+w+" "+this.height+"px)";var y="url("+this.src+")";if(s.src){$("#wrap").css("background-image","-webkit-linear-gradient"+x+", "+y);$("#wrap").css("background-image","-moz-linear-gradient"+x+", "+y);$("#wrap").css("background-image","linear-gradient"+x+", "+y)}}}function e(g){$("#stage").fadeOut("slow").load("/wp/wp-admin/admin-ajax.php",{action:"get_participant_summary",post_id:g},function(){$("#stage").fadeIn("slow")})}function b(w,v){var u=$("#mapview").width(),g=$(v).position().top,s=$(v).position().left;if(s<u/2){dx_offset=30}else{dx_offset=-340}$("#popover").css("top",g).css("left",s+dx_offset);$("#popover .popover-name").text(w.name);$("#popover .popover-location").text(w.location);$("#popover .popover-occupation").text(w.occupation);$("#popover .popover-thumbnail").attr("src",w.thumbnail);$("#popover .popover-permalink").attr("href",w.permalink);$("#popover, .overlay").show()}function c(g){$(".mapthumb").hide();$("#mapthumb-"+g).show()}$(".carousel").carousel("pause");$("#featured-carousel").bind("slide",function(){$("#featured-carousel").css("overflow","hidden")});$("#featured-carousel").bind("slid",function(){$("#featured-carousel").css("overflow","visible")});$("#nav-featured .participant-thumbnail").click(function(){$(".home-thumbnail, .participant-thumbnail").removeClass("active");$(this).addClass("active");$("#home").fadeOut("slow");e($(this).data("id"))});$("#nav-featured .home-thumbnail").click(function(){$("#stage").fadeOut("slow",function(){$(".participant-thumbnail").removeClass("active");$(".home-thumbnail").addClass("active");$("#home").fadeIn("slow")})});if($("#mapview").length){var q=d3.geo.mercator().scale($("#mapview").width()).translate([$("#mapview").width()/2,$("#mapview").height()/1.75]),r=d3.geo.path().projection(q),a=d3.select("#mapview").append("svg:svg").attr("height","100%").attr("width","100%"),i=a.append("svg:defs"),p=a.append("svg:g").attr("id","countries"),o=a.append("svg:g").attr("id","cells"),m=a.append("svg:g").attr("id","locations"),k=[];participants=participants.filter(function(g){if(true){var s=[+g.longitude,+g.latitude];k.push(q(s));return true}});var d=i.selectAll("thumbnails").data(participants).enter().append("svg:pattern").attr("id",function(s,g){return"image-"+g}).attr("patternUnits","objectBoundingBox").attr("width",50).attr("height",50).append("svg:image").attr("xlink:href",function(g){return g.thumbnail}).attr("x",0).attr("y",0).attr("width",50).attr("height",50);var n=d3.geom.voronoi(k);var l=o.selectAll("g").data(participants).enter().append("svg:g").attr("opacity",0);l.append("svg:path").attr("d",function(s,g){return"M"+n[g].join("L")+"Z"});var f=m.selectAll("marker").data(participants).enter().append("svg:g").attr("class",function(g){return"marker "+g.continent}).attr("transform",function(g){return"translate("+q([+g.longitude,+g.latitude])+")"}).on("click",function(g){b(g,this)});f.append("svg:circle").attr("id",function(s,g){return"mapthumb-"+g}).attr("class","mapthumb").attr("r",25).attr("fill",function(s,g){return"url(#image-"+g+")"});d3.json("/content/themes/glp/js/vendor/countries.json",function(g){p.selectAll("path").data(g.features).enter().append("svg:path").attr("d",r)});d3.json("/content/themes/glp/js/vendor/countries-hires.json",function(g){p.selectAll("path").remove();p.selectAll("path").data(g.features).enter().append("svg:path").attr("d",r)})}$(".overlay").hide();$("#popover").hide();$("#popover .close").click(function(){$("#popover, .overlay").hide();$(this).parent().hide()});$(".overlay").click(function(){$("#popover, .overlay").hide()});$(".participant-clip-listing .clip-thumbnail").click(function(){$("html, body").scrollTop(0);var g=$(this).data("clip-id");$(this).parents(".participant-clip-listing").addClass("active").siblings().removeClass("active");$("#stage").slideUp().load("/wp/wp-admin/admin-ajax.php",{action:"get_participant_clip",clip_id:g},function(){$("#stage").delay(250).slideDown()})});if($(".blog").length){var j=$(".blog .post").first().data("bg");if(j){h(j,{to:"#262626"})}$(".past-posts .post").each(function(){var g=$(this).data("bg");if(g){$(this).css("background-image","url("+g+")")}})}if($(".events-list").length){$(".tribe-events-event").each(function(){var g=$(this).data("bg");if(g){$(this).css("background-image","url("+g+")")}})}$(".search-sidebar :checkbox").change(function(){var g=$(this).val();$(".search-result."+g).slideToggle("",function(){$(".results-found").html($(".search-result:visible").length)})});$(".participant-video-controls").each(function(){var u=$(this).siblings(".participant-video-embed").attr("id");var g=players[u];$("#"+u).bind("player_ready",videoSetTimer);$("#"+u).bind("player_ready",videoUpdateTimer);$("#"+u).bind("player_time_update",videoUpdateTimer);$("#"+u).bind("player_time_update",videoUpdatePosition);var s=$("#"+u).siblings(".participant-video-controls").find(".control-slider").slider({range:"min",min:0,max:1000});$(s).on("slidestop",function(v,w){var x=$(this).closest(".participant-clip").find(".participant-video-embed").attr("id");players[x].seekTo(Math.round((players[x].getDuration()*(w.value/1000))*100)/100,true);$("#"+x).bind("player_time_update",videoUpdatePosition)});$(s).on("slidestart",function(v,w){var x=$(this).closest(".participant-clip").find(".participant-video-embed").attr("id");$("#"+x).unbind("player_time_update",videoUpdatePosition)})});$(".controls").live("click",function(){var u=$(this).closest(".participant-clip").find(".participant-video-embed").attr("id");var g=players[u];var s=$(this).attr("data-control");switch(s){case"play":players[u].playVideo();break;case"pause":players[u].pauseVideo();break}});$(".taggable-area").each(function(){var g=$(this).next().find(".content").html();var s=$(this).next().find(".title").html();$(this).popover({html:true,animation:false,content:g,title:s})}).click(function(y){var g=$(this).closest(".participant-clip").find(".participant-video-embed").attr("id");var B=players[g];var w=parseInt(y.pageX-$(this).offset().left);var z=(w/$(this).width());var A=Math.round((B.getDuration()*z)*100)/100;var u=parseInt(A/60)%60;var C=parseInt(A%60,10);var v=w-($(this).next().width()/2);var x=$(this).next();$(this).data("m",u).data("s",C).data("p",w);$(x).find(".comment-box").prepend($("#marker-"+w+" .content").html());$(x).css("left",v).css("top",(0-$(this).next().height()-13)).find(".time").text(u+":"+C)});$(document).on("click",".popover .close",function(){$(this).closest(".popover").prev().popover("hide")});$(document).on("submit",".popover form",function(){$.post(glpAjax.ajaxurl,{action:"clip_submit_comment",comment:$(this).find('input[name="comment"]').val(),minutes:$(".taggable-area").data("m"),seconds:$(".taggable-area").data("s"),position:$(".taggable-area").data("p"),post_id:$(".participant-video-embed").attr("id").replace("participant-video-embed-","")},function(g){alert($.parseJSON(g).message)});return false})});var players={};var t;(function(){var a=document.createElement("script");a.src=(location.protocol=="https:"?"https":"http")+"://www.youtube.com/player_api";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)})();function onYouTubePlayerAPIReady(){YT_ready(true)}function getFrameID(d){var c=document.getElementById(d);if(c){if(/^iframe$/i.test(c.tagName)){return d}var a=c.getElementsByTagName("iframe");if(!a.length){return null}for(var b=0;b<a.length;b++){if(/^https?:\/\/(?:www\.)?youtube(?:-nocookie)?\.com(\/|$)/i.test(a[b].src)){break}}c=a[b];if(c.id){return c.id}do{d+="-frame"}while(document.getElementById(d));c.id=d;return d}return null}var YT_ready=(function(){var b=[],a=false;return function(c,d){if(c===true){a=true;while(b.length){b.shift()()}}else{if(typeof c=="function"){if(a){c()}else{b[d?"unshift":"push"](c)}}}}})();YT_ready(function(){$(".participant-video-embed").each(function(){var a=this.id;var b=getFrameID(a);if(b){players[b]=new YT.Player(b,{events:{onStateChange:onStateChange(b,a),onReady:onReady(b,a)}})}})});function onStateChange(b,a){return function(d){var c=players[b];switch(d.data){case 1:case 3:console.log("playing/buffering");t=setInterval(function(){playerTimeUpdate(b)},1000);break;case 2:case 0:console.log("paused/ended");clearTimeout(t);break}}}function onReady(b,a){return function(e){var d=players[b];var c=!d.cueVideoByFlashvars;if(c&&!d.getDuration()){alert("Youtube html5 detected. Tagging/commenting on this clip won't work until you hit play")}$("#"+b).trigger("player_ready")}}function playerTimeUpdate(a){$("#"+a).trigger("player_time_update")}function videoUpdatePosition(c){var a=players[c.currentTarget.id];var b=$("#"+c.currentTarget.id).siblings(".participant-video-controls").find(".control-slider");$(b).slider("value",(a.getCurrentTime()/a.getDuration())*1000)}function videoUpdateTimer(d){var b=players[d.currentTarget.id];var a=parseInt(b.getCurrentTime()/60)%60;var c=parseInt(b.getCurrentTime()%60,10);$(".control-time-current .time-m").text(a);$(".control-time-current .time-s").text(c)}function videoSetTimer(d){var b=players[d.currentTarget.id];var a=parseInt(b.getDuration()/60)%60;var c=parseInt(b.getDuration()%60,10);$(".control-time-total .time-m").text(a);$(".control-time-total .time-s").text(c)};