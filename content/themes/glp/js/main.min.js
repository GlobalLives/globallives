$(function(){$("a:has(img)").addClass("image-link");function h(u,g){var t="rgba(0,0,0,0)",v="rgba(0,0,0,0)",s=new Image();if(g){t=g.from?g.from:t;v=g.to?g.to:v}s.src=u;s.onload=function(){var w="("+t+" 0, "+v+" "+this.height+"px)";var x="url("+this.src+")";if(s.src){$("#wrap").css("background-image","-webkit-linear-gradient"+w+", "+x);$("#wrap").css("background-image","-moz-linear-gradient"+w+", "+x);$("#wrap").css("background-image","linear-gradient"+w+", "+x)}}}function e(g){$("#stage").fadeOut("slow").load("/wp/wp-admin/admin-ajax.php",{action:"get_participant_summary",post_id:g},function(){$("#stage").fadeIn("slow")})}function b(v,u){var t=$("#mapview").width(),g=$(u).position().top,s=$(u).position().left;if(s<t/2){dx_offset=30}else{dx_offset=-340}$("#popover").css("top",g).css("left",s+dx_offset);$("#popover .popover-name").text(v.name);$("#popover .popover-location").text(v.location);$("#popover .popover-occupation").text(v.occupation);$("#popover .popover-thumbnail").attr("src",v.thumbnail);$("#popover .popover-permalink").attr("href",v.permalink);$("#popover, .overlay").show()}function c(g){$(".mapthumb").hide();$("#mapthumb-"+g).show()}$(".carousel").carousel("pause");$("#featured-carousel").bind("slide",function(){$("#featured-carousel").css("overflow","hidden")});$("#featured-carousel").bind("slid",function(){$("#featured-carousel").css("overflow","visible")});$("#nav-featured .participant-thumbnail").click(function(){$(".home-thumbnail, .participant-thumbnail").removeClass("active");$(this).addClass("active");$("#home").fadeOut("slow");e($(this).data("id"))});$("#nav-featured .home-thumbnail").click(function(){$("#stage").fadeOut("slow",function(){$(".participant-thumbnail").removeClass("active");$(".home-thumbnail").addClass("active");$("#home").fadeIn("slow")})});if($("#mapview").length){var q=d3.geo.mercator().scale($("#mapview").width()).translate([$("#mapview").width()/2,$("#mapview").height()/1.75]),r=d3.geo.path().projection(q),a=d3.select("#mapview").append("svg:svg").attr("height","100%").attr("width","100%"),i=a.append("svg:defs"),p=a.append("svg:g").attr("id","countries"),o=a.append("svg:g").attr("id","cells"),m=a.append("svg:g").attr("id","locations"),k=[];participants=participants.filter(function(g){if(true){var s=[+g.longitude,+g.latitude];k.push(q(s));return true}});var d=i.selectAll("thumbnails").data(participants).enter().append("svg:pattern").attr("id",function(s,g){return"image-"+g}).attr("patternUnits","objectBoundingBox").attr("width",50).attr("height",50).append("svg:image").attr("xlink:href",function(g){return g.thumbnail}).attr("x",0).attr("y",0).attr("width",50).attr("height",50);var n=d3.geom.voronoi(k);var l=o.selectAll("g").data(participants).enter().append("svg:g").attr("opacity",0);l.append("svg:path").attr("d",function(s,g){return"M"+n[g].join("L")+"Z"});var f=m.selectAll("marker").data(participants).enter().append("svg:g").attr("class",function(g){return"marker "+g.continent}).attr("transform",function(g){return"translate("+q([+g.longitude,+g.latitude])+")"}).on("click",function(g){b(g,this)});f.append("svg:circle").attr("id",function(s,g){return"mapthumb-"+g}).attr("class","mapthumb").attr("r",25).attr("fill",function(s,g){return"url(#image-"+g+")"});d3.json("/content/themes/glp/js/vendor/countries.json",function(g){p.selectAll("path").data(g.features).enter().append("svg:path").attr("d",r)});d3.json("/content/themes/glp/js/vendor/countries-hires.json",function(g){p.selectAll("path").remove();p.selectAll("path").data(g.features).enter().append("svg:path").attr("d",r)})}$(".overlay").hide();$("#popover").hide();$("#popover .close").click(function(){$("#popover, .overlay").hide();$(this).parent().hide()});$(".overlay").click(function(){$("#popover, .overlay").hide()});$(".participant-clip-listing .clip-thumbnail").click(function(){$("html, body").scrollTop(0);var g=$(this).data("clip-id");$(this).parents(".participant-clip-listing").addClass("active").siblings().removeClass("active");$("#stage").slideUp().load("/wp/wp-admin/admin-ajax.php",{action:"get_participant_clip",clip_id:g},function(){$("#stage").delay(250).slideDown()})});if($(".blog").length){var j=$(".blog .post").first().data("bg");if(j){h(j,{to:"#262626"})}$(".past-posts .post").each(function(){var g=$(this).data("bg");if(g){$(this).css("background-image","url("+g+")")}})}if($(".events-list").length){$(".tribe-events-event").each(function(){var g=$(this).data("bg");if(g){$(this).css("background-image","url("+g+")")}})}$(".search-sidebar :checkbox").change(function(){var g=$(this).val();$(".search-result."+g).slideToggle("",function(){$(".results-found").html($(".search-result:visible").length)})})});