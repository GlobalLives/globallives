$(function(){$("a:has(img)").addClass("image-link");function n(z,g){var y="rgba(0,0,0,0)",A="rgba(0,0,0,0)",x=new Image();if(g){y=g.from?g.from:y;A=g.to?g.to:A}x.src=z;x.onload=function(){var B="("+y+" 0, "+A+" "+this.height+"px)";var C="url("+this.src+")";if(x.src){$("#wrap").css("background-image","-webkit-linear-gradient"+B+", "+C);$("#wrap").css("background-image","-moz-linear-gradient"+B+", "+C);$("#wrap").css("background-image","linear-gradient"+B+", "+C)}}}function e(g){$("#stage").fadeOut("slow").load("/wp/wp-admin/admin-ajax.php",{action:"get_participant_summary",post_id:g},function(){$("#stage").fadeIn("slow")})}function q(A,z){var y=$("#mapview").width(),g=$(z).position().top,x=$(z).position().left;if(x<y/2){dx_offset=30}else{dx_offset=-340}$("#popover").css("top",g).css("left",x+dx_offset);$("#popover .popover-name").text(A.name);$("#popover .popover-location").text(A.location);$("#popover .popover-occupation").text(A.occupation);$("#popover .popover-thumbnail").attr("src",A.thumbnail);$("#popover .popover-permalink").attr("href",A.permalink);$("#popover, .overlay").show()}function i(g){$(".mapthumb").hide();$("#mapthumb-"+g).show()}$(".carousel").carousel("pause");$("#featured-carousel").bind("slide",function(){$("#featured-carousel").css("overflow","hidden")});$("#featured-carousel").bind("slid",function(){$("#featured-carousel").css("overflow","visible")});$("#nav-featured .participant-thumbnail").click(function(){$(".home-thumbnail, .participant-thumbnail").removeClass("active");$(this).addClass("active");$("#home").fadeOut("slow");e($(this).data("id"))});$("#nav-featured .home-thumbnail").click(function(){$("#stage").fadeOut("slow",function(){$(".participant-thumbnail").removeClass("active");$(".home-thumbnail").addClass("active");$("#home").fadeIn("slow")})});if($("#mapview").length){var j=d3.geo.mercator().scale($("#mapview").width()).translate([$("#mapview").width()/2,$("#mapview").height()/1.75]),m=d3.geo.path().projection(j),v=d3.select("#mapview").append("svg:svg").attr("height","100%").attr("width","100%"),b=v.append("svg:defs"),d=v.append("svg:g").attr("id","countries"),h=v.append("svg:g").attr("id","cells"),u=v.append("svg:g").attr("id","locations"),k=[];participants=participants.filter(function(g){if(true){var x=[+g.longitude,+g.latitude];k.push(j(x));return true}});var c=b.selectAll("thumbnails").data(participants).enter().append("svg:pattern").attr("id",function(x,g){return"image-"+g}).attr("patternUnits","objectBoundingBox").attr("width",50).attr("height",50).append("svg:image").attr("xlink:href",function(g){return g.thumbnail}).attr("x",0).attr("y",0).attr("width",50).attr("height",50);var t=d3.geom.voronoi(k);var o=h.selectAll("g").data(participants).enter().append("svg:g").attr("opacity",0);o.append("svg:path").attr("d",function(x,g){return"M"+t[g].join("L")+"Z"});var p=u.selectAll("marker").data(participants).enter().append("svg:g").attr("class",function(g){return"marker "+g.continent}).attr("transform",function(g){return"translate("+j([+g.longitude,+g.latitude])+")"}).on("click",function(g){q(g,this)});p.append("svg:circle").attr("id",function(x,g){return"mapthumb-"+g}).attr("class","mapthumb").attr("r",25).attr("fill",function(x,g){return"url(#image-"+g+")"});d3.json("/content/themes/glp/js/vendor/countries.json",function(g){d.selectAll("path").data(g.features).enter().append("svg:path").attr("d",m)});d3.json("/content/themes/glp/js/vendor/countries-hires.json",function(g){d.selectAll("path").remove();d.selectAll("path").data(g.features).enter().append("svg:path").attr("d",m)})}$(".overlay").hide();$("#popover").hide();$("#popover .close").click(function(){$("#popover, .overlay").hide();$(this).parent().hide()});$(".overlay").click(function(){$("#popover, .overlay").hide()});$(".participant-clip-listing .clip-thumbnail").click(function(){$("html, body").scrollTop(0);var g=$(this).data("clip-id");$(this).parents(".participant-clip-listing").addClass("active").siblings().removeClass("active");$("#stage").slideUp().load("/wp/wp-admin/admin-ajax.php",{action:"get_participant_clip",clip_id:g},function(){$("#stage").delay(250).slideDown()})});if($(".blog").length){var f=$(".blog .post").first().data("bg");if(f){n(f,{to:"#262626"})}$(".past-posts .post").each(function(){var g=$(this).data("bg");if(g){$(this).css("background-image","url("+g+")")}})}if($(".events-list").length){$(".tribe-events-event").each(function(){var g=$(this).data("bg");if(g){$(this).css("background-image","url("+g+")")}})}$(".search-sidebar :checkbox").change(function(){var g=$(this).val();$(".search-result."+g).slideToggle("",function(){$(".results-found").html($(".search-result:visible").length)})});function a(x){var g=$(".control-slider");$(g).slider("value",(this.currentTime()/this.duration())*1000)}function l(y){var g=parseInt(this.roundTime()/60)%60;var x=parseInt(this.roundTime()%60,10);$(".control-time-current .time-m").text(g);$(".control-time-current .time-s").text(x)}function r(y){var g=parseInt(this.duration()/60)%60;var x=parseInt(this.duration()%60,10);$(".control-time-total .time-m").text(g);$(".control-time-total .time-s").text(x)}if($(".participant-video-controls").length){if(swfobject.hasFlashPlayerVersion("1")){$(".participant-video-embed").each(function(){players[this.id]=Popcorn.youtube(this.id,$(this).attr("data-src"));players[this.id].preload("auto");players[this.id].on("loadedmetadata",r);players[this.id].on("loadedmetadata",l);players[this.id].on("seeked",l);players[this.id].on("play",function(){this.on("timeupdate",a);this.on("timeupdate",l)});players[this.id].on("pause",function(){this.off("timeupdate",a);this.off("timeupdate",l)})});$(".control-slider").slider({range:"min",min:0,max:1000});$(".control-slider").on("slidestop",function(g,x){var y=$(this).closest(".participant-clip").find(".participant-video-embed").attr("id");players[y].currentTime(Math.round((players[y].duration()*(x.value/1000))*100)/100)});$(".control-slider").on("slidestart",function(g,x){var y=$(this).closest(".participant-clip").find(".participant-video-embed").attr("id");players[y].off("timeupdate",a)});$(".controls").on("click",function(){var x=$(this).closest(".participant-clip").find(".participant-video-embed").attr("id");var g=$(this).attr("data-control");switch(g){case"play":players[x].play();break;case"pause":players[x].pause();break}});$(".taggable-area").click(function(B){var C=$(this).closest(".participant-clip").find(".participant-video-embed").attr("id");var x=B.pageX-$(this).offset().left;var A=(x/$(this).width());var z=Math.round((players[C].duration()*A)*100)/100;var g=parseInt(z/60)%60;var y=parseInt(z%60,10);alert("An event at "+g+" minutes and "+y+" seconds")})}else{var w=document.createElement("script");w.src="//www.youtube.com/iframe_api";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(w,s)}}});var players={};function onYouTubeIframeAPIReady(){if($.isEmptyObject(players)){$(".participant-video-embed").each(function(){players[this.id]=new YT.Player(this.id,{videoId:$(this).attr("data-youtube"),events:{onReady:onPlayerReady}})})}}function onPlayerReady(a){$(".controls").on("click",function(){var c=$(this).closest(".participant-clip").find(".participant-video-embed").attr("id");var b=$(this).attr("data-control");switch(b){case"play":players[c].playVideo();break;case"pause":players[c].pauseVideo();break}})};