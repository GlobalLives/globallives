$(function(){$("a:has(img)").addClass("image-link");function m(y,g){var x="rgba(0,0,0,0)",z="rgba(0,0,0,0)",w=new Image();if(g){x=g.from?g.from:x;z=g.to?g.to:z}w.src=y;w.onload=function(){var A="("+x+" 0, "+z+" "+this.height+"px)";var B="url("+this.src+")";if(w.src){$("#wrap").css("background-image","-webkit-linear-gradient"+A+", "+B);$("#wrap").css("background-image","-moz-linear-gradient"+A+", "+B);$("#wrap").css("background-image","linear-gradient"+A+", "+B)}}}function e(g){$("#stage").fadeOut("slow").load("/wp/wp-admin/admin-ajax.php",{action:"get_participant_summary",post_id:g},function(){$("#stage").fadeIn("slow")})}function p(z,y){var x=$("#mapview").width(),g=$(y).position().top,w=$(y).position().left;if(w<x/2){dx_offset=30}else{dx_offset=-340}$("#popover").css("top",g).css("left",w+dx_offset);$("#popover .popover-name").text(z.name);$("#popover .popover-location").text(z.location);$("#popover .popover-occupation").text(z.occupation);$("#popover .popover-thumbnail").attr("src",z.thumbnail);$("#popover .popover-permalink").attr("href",z.permalink);$("#popover, .overlay").show()}function i(g){$(".mapthumb").hide();$("#mapthumb-"+g).show()}$(".carousel").carousel("pause");$("#featured-carousel").bind("slide",function(){$("#featured-carousel").css("overflow","hidden")});$("#featured-carousel").bind("slid",function(){$("#featured-carousel").css("overflow","visible")});$("#nav-featured .participant-thumbnail").click(function(){$(".home-thumbnail, .participant-thumbnail").removeClass("active");$(this).addClass("active");$("#home").fadeOut("slow");e($(this).data("id"))});$("#nav-featured .home-thumbnail").click(function(){$("#stage").fadeOut("slow",function(){$(".participant-thumbnail").removeClass("active");$(".home-thumbnail").addClass("active");$("#home").fadeIn("slow")})});if($("#mapview").length){var j=d3.geo.mercator().scale($("#mapview").width()).translate([$("#mapview").width()/2,$("#mapview").height()/1.75]),l=d3.geo.path().projection(j),u=d3.select("#mapview").append("svg:svg").attr("height","100%").attr("width","100%"),a=u.append("svg:defs"),c=u.append("svg:g").attr("id","countries"),h=u.append("svg:g").attr("id","cells"),s=u.append("svg:g").attr("id","locations"),k=[];participants=participants.filter(function(g){if(true){var w=[+g.longitude,+g.latitude];k.push(j(w));return true}});var b=a.selectAll("thumbnails").data(participants).enter().append("svg:pattern").attr("id",function(w,g){return"image-"+g}).attr("patternUnits","objectBoundingBox").attr("width",50).attr("height",50).append("svg:image").attr("xlink:href",function(g){return g.thumbnail}).attr("x",0).attr("y",0).attr("width",50).attr("height",50);var q=d3.geom.voronoi(k);var n=h.selectAll("g").data(participants).enter().append("svg:g").attr("opacity",0);n.append("svg:path").attr("d",function(w,g){return"M"+q[g].join("L")+"Z"});var o=s.selectAll("marker").data(participants).enter().append("svg:g").attr("class",function(g){return"marker "+g.continent}).attr("transform",function(g){return"translate("+j([+g.longitude,+g.latitude])+")"}).on("click",function(g){p(g,this)});o.append("svg:circle").attr("id",function(w,g){return"mapthumb-"+g}).attr("class","mapthumb").attr("r",25).attr("fill",function(w,g){return"url(#image-"+g+")"});d3.json("/content/themes/glp/js/vendor/countries.json",function(g){c.selectAll("path").data(g.features).enter().append("svg:path").attr("d",l)});d3.json("/content/themes/glp/js/vendor/countries-hires.json",function(g){c.selectAll("path").remove();c.selectAll("path").data(g.features).enter().append("svg:path").attr("d",l)})}$(".overlay").hide();$("#popover").hide();$("#popover .close").click(function(){$("#popover, .overlay").hide();$(this).parent().hide()});$(".overlay").click(function(){$("#popover, .overlay").hide()});$(".participant-clip-listing .clip-thumbnail").click(function(){$("html, body").scrollTop(0);var g=$(this).data("clip-id");$(this).parents(".participant-clip-listing").addClass("active").siblings().removeClass("active");$("#stage").slideUp().load("/wp/wp-admin/admin-ajax.php",{action:"get_participant_clip",clip_id:g},function(){$("#stage").delay(250).slideDown()})});if($(".blog").length){var f=$(".blog .post").first().data("bg");if(f){m(f,{to:"#262626"})}$(".past-posts .post").each(function(){var g=$(this).data("bg");if(g){$(this).css("background-image","url("+g+")")}})}if($(".events-list").length){$(".tribe-events-event").each(function(){var g=$(this).data("bg");if(g){$(this).css("background-image","url("+g+")")}})}$(".search-sidebar :checkbox").change(function(){var g=$(this).val();$(".search-result."+g).slideToggle("",function(){$(".results-found").html($(".search-result:visible").length)})});$(".participant-video-controls").each(function(){var x=$(this).siblings(".participant-video-embed").attr("id");var g=players[x];$("#"+x).bind("player_ready",videoSetTimer);$("#"+x).bind("player_ready",videoUpdateTimer);$("#"+x).bind("player_time_update",videoUpdateTimer);$("#"+x).bind("player_time_update",videoUpdatePosition);var w=$("#"+x).siblings(".participant-video-controls").find(".control-slider").slider({range:"min",min:0,max:1000});$(w).on("slidestop",function(y,z){var A=$(this).closest(".participant-clip").find(".participant-video-embed").attr("id");players[A].seekTo(Math.round((players[A].getDuration()*(z.value/1000))*100)/100,true);$("#"+A).bind("player_time_update",videoUpdatePosition)});$(w).on("slidestart",function(y,z){var A=$(this).closest(".participant-clip").find(".participant-video-embed").attr("id");$("#"+A).unbind("player_time_update",videoUpdatePosition)})});$(".controls").live("click",function(){var y=$(this).closest(".participant-clip").find(".participant-video-embed").attr("id");var g=players[y];var x=$(this).attr("data-control");switch(x){case"play":players[y].playVideo();$(this).attr("data-control","pause").find("span").toggleClass("icon-pause","icon-play");break;case"pause":players[y].pauseVideo();$(this).attr("data-control","play").find("span").toggleClass("icon-pause","icon-play");break;case"fullscreen":var w=document.getElementById(y);if(w.requestFullScreen){w.requestFullScreen()}else{if(w.mozRequestFullScreen){w.mozRequestFullScreen()}else{if(w.webkitRequestFullScreen){w.webkitRequestFullScreen()}}}break}});$(".taggable-area").each(function(){var g=$(this).next().find(".content").html();var w=$(this).next().find(".title").html();$(this).popover({html:true,animation:false,content:g,title:w})}).click(function(A){var g=$(this).closest(".participant-clip").find(".participant-video-embed").attr("id");var D=players[g];var y=parseInt(A.pageX-$(this).offset().left);var B=(y/$(this).width());var C=Math.round((D.getDuration()*B)*100)/100;var w=parseInt(C/60)%60;var E=parseInt(C%60,10);var x=y-($(this).next().width()/2);var z=$(this).next();$(this).data("m",w).data("s",E).data("p",y);$(z).find(".comment-box").prepend($("#marker-"+y+" .content").html());$(z).css("left",x).find(".time").text(w+":"+E);d(z)});$(document).on("click",".popover .close",function(){$(this).closest(".popover").prev().popover("hide")});$(document).on("submit",".popover form",function(){$(this).find(".error").fadeOut("slow",function(){$(this).remove()});$.post(glpAjax.ajaxurl,{action:"clip_submit_comment",comment:$(this).find('input[name="comment"]').val(),minutes:$(".taggable-area").data("m"),seconds:$(".taggable-area").data("s"),position:$(".taggable-area").data("p"),post_id:$(".participant-video-embed").attr("id").replace("participant-video-embed-","")},function(g){r=$.parseJSON(g);$(".comment-box").prepend(r.message).closest("form").find("input").val("");if(r.success){v(r.success,r.message)}d($(".popover"))});return false});function d(g){$(g).css("top",(0-$(g).height()-20))}function v(g,x){var w=$("#marker-"+g);if(w.length){$(w).find(".content").prepend(x)}else{$(".clip-markers").append('<a class="marker" id="marker-'+g+'" style="left: '+g+'px"><div class="arrow"></div><div class="hide content">'+x+"</div></div>")}}});var players={};var t;(function(){var a=document.createElement("script");a.src=(location.protocol=="https:"?"https":"http")+"://www.youtube.com/player_api";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)})();function onYouTubePlayerAPIReady(){YT_ready(true)}function getFrameID(d){var c=document.getElementById(d);if(c){if(/^iframe$/i.test(c.tagName)){return d}var a=c.getElementsByTagName("iframe");if(!a.length){return null}for(var b=0;b<a.length;b++){if(/^https?:\/\/(?:www\.)?youtube(?:-nocookie)?\.com(\/|$)/i.test(a[b].src)){break}}c=a[b];if(c.id){return c.id}do{d+="-frame"}while(document.getElementById(d));c.id=d;return d}return null}var YT_ready=(function(){var b=[],a=false;return function(c,d){if(c===true){a=true;while(b.length){b.shift()()}}else{if(typeof c=="function"){if(a){c()}else{b[d?"unshift":"push"](c)}}}}})();YT_ready(function(){$(".participant-video-embed").each(function(){var a=this.id;var b=getFrameID(a);if(b){players[b]=new YT.Player(b,{events:{onStateChange:onStateChange(b,a),onReady:onReady(b,a)}})}})});function onStateChange(b,a){return function(d){var c=players[b];switch(d.data){case 1:case 3:$("#"+b).trigger("player_start_play_buffer");t=setInterval(function(){playerTimeUpdate(b)},1000);break;case 2:case 0:$("#"+b).trigger("player_pause_end");clearTimeout(t);break}}}function onReady(b,a){return function(e){var d=players[b];var c=!d.cueVideoByFlashvars;if(c&&!d.getDuration()){alert("Youtube html5 detected. Tagging/commenting on this clip won't work until you hit play")}$("#"+b).trigger("player_ready")}}function playerTimeUpdate(a){$("#"+a).trigger("player_time_update")}function videoUpdatePosition(c){var a=players[c.currentTarget.id];var b=$("#"+c.currentTarget.id).siblings(".participant-video-controls").find(".control-slider");$(b).slider("value",(a.getCurrentTime()/a.getDuration())*1000)}function videoUpdateTimer(d){var b=players[d.currentTarget.id];var a=parseInt(b.getCurrentTime()/60)%60;var c=parseInt(b.getCurrentTime()%60,10);$(".control-time-current .time-m").text(a);$(".control-time-current .time-s").text(c)}function videoSetTimer(d){var b=players[d.currentTarget.id];var a=parseInt(b.getDuration()/60)%60;var c=parseInt(b.getDuration()%60,10);$(".control-time-total .time-m").text(a);$(".control-time-total .time-s").text(c)};