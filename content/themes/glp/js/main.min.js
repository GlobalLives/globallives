$(function(){function e(e,t){var n="rgba(0,0,0,0)",r="rgba(0,0,0,0)",i=new Image;if(t){n=t.from?t.from:n;r=t.to?t.to:r}i.src=e;i.onload=function(){var e="("+n+" 0, "+r+" "+this.height+"px)",t="url("+this.src+")";if(i.src){$("#wrap").css("background-image","-webkit-linear-gradient"+e+", "+t);$("#wrap").css("background-image","-moz-linear-gradient"+e+", "+t);$("#wrap").css("background-image","linear-gradient"+e+", "+t)}}}function t(e){$("#stage").fadeOut("slow").load("/wp/wp-admin/admin-ajax.php",{action:"get_participant_summary",post_id:e},function(){$("#stage").fadeIn("slow")})}function n(e,t){var n=$("#mapview").width(),r=$(t).position().top,i=$(t).position().left;i<n/2?dx_offset=30:dx_offset=-340;$("#popover").css("top",r).css("left",i+dx_offset);$("#popover .popover-name").text(e.name);$("#popover .popover-location").text(e.location);$("#popover .popover-occupation").text(e.occupation);$("#popover .popover-series").html(e.series);$("#popover .popover-thumbnail").attr("src",e.thumbnail);$("#popover .popover-permalink").attr("href",e.permalink);$("#popover, .overlay").show()}function r(e){$(".mapthumb").hide();$("#mapthumb-"+e).show()}function i(e){var t=0;e.each(function(){var e=$(this).height();e>t&&(t=e)});e.height(t)}$("a:has(img)").addClass("image-link");i($("#nav-modules .widget"));if($("body.page-home").length){$(".carousel").carousel("pause");$("#featured-carousel").bind("slide",function(){$("#featured-carousel").css("overflow","hidden")});$("#featured-carousel").bind("slid",function(){$("#featured-carousel").css("overflow","visible")});$("#nav-featured .participant-thumbnail").click(function(){$(".home-thumbnail, .participant-thumbnail").removeClass("active");$(this).addClass("active");$("#home").fadeOut("slow");t($(this).data("id"))});$("#nav-featured .home-thumbnail").click(function(){$("#stage").fadeOut("slow",function(){$(".participant-thumbnail").removeClass("active");$(".home-thumbnail").addClass("active");$("#home").fadeIn("slow")})})}if($("body.page-explore").length){$(".btn-mapview").click(function(){$(this).addClass("active").siblings().removeClass("active");$(".view").slideUp(500,function(){$("#mapview").delay(700).slideDown(500)})});$(".btn-gridview").click(function(){$(this).addClass("active").siblings().removeClass("active");$(".view").slideUp(500,function(){$("#gridview").delay(700).slideDown(500)})});$("#nav-explore input, #nav-explore select").change(function(){$(participants).each(function(){var e=$("#participant-"+this.id);e.removeClass("filtered");$("select[name=series]").val()!=="All"&&this.series!==$("select[name=series]").val()&&e.addClass("filtered");$("select[name=gender]").val()!=="All"&&this.gender!==$("select[name=gender]").val()&&e.addClass("filtered");$("select[name=income]").val()!=="All"&&this.income!==$("select[name=income]").val()&&e.addClass("filtered");$("select[name=age]").val()!=="All"&&this.age!==$("select[name=age]").val()&&e.addClass("filtered");!$("input[name=proposed]:checked").val()&&this.proposed&&e.addClass("filtered")});$(".participant-grid").hide();$(".participant-grid:not(.filtered)").fadeIn();return!1})}if($("#mapview").length){$("#mapview").hide();var s=$("#mapview").height(),o=$("#mapview").width(),u=d3.geo.mercator().scale(o*.15).translate([o/2,s/1.75]),a=d3.geo.path().projection(u),f=d3.behavior.zoom().translate(u.translate()).scale(u.scale()).scaleExtent([o*.15,8*s]),l=d3.select("#mapview").append("svg:svg").attr("height",s).attr("width",o),c=l.append("svg:g").attr("id","countries");c.append("rect").attr("class","background").attr("width",o).attr("height",s);var h=l.append("svg:g").attr("id","locations"),p=[];participants=participants.filter(function(e){var t=[+e.longitude,+e.latitude];p.push(u(t));return!0});var d=l.append("svg:defs").selectAll("thumbnails").data(participants).enter().append("svg:pattern").attr("id",function(e,t){return"image-"+t}).attr("patternUnits","objectBoundingBox").attr("width",50).attr("height",50).append("svg:image").attr("xlink:href",function(e){return e.thumbnail}).attr("x",0).attr("y",0).attr("width",50).attr("height",50),v=h.selectAll("marker").data(participants).enter().append("svg:g").attr("class",function(e){return"marker "+e.continent+(e.proposed?" proposed":"")}).attr("transform",function(e){return"translate("+u([+e.longitude,+e.latitude])+")"}).on("click",function(e){n(e,this)});v.append("svg:circle").attr("class","mapthumb").attr("id",function(e,t){return"mapthumb-"+t}).attr("r",25).attr("fill",function(e,t){return"url(#image-"+t+")"});var m=v.append("svg:text").attr("class","label").attr("dx",-25).attr("dy",40);m.append("svg:tspan").attr("class","name").text(function(e){return e.name});m.append("svg:tspan").attr("class","location").text(function(e){return e.location}).attr("x",-25).attr("dy",18);m.append("svg:tspan").attr("class","occupation").text(function(e){return e.occupation}).attr("x",-25).attr("dy",18);d3.json("/content/themes/glp/js/vendor/countries.json",function(e){c.selectAll("path").data(e.features).enter().append("svg:path").attr("d",a)});function g(e){var t=a.centroid(e),n=u.translate();u.translate([n[0]-t[0]+o/2,n[1]-t[1]+s/2]);f.translate(u.translate());c.selectAll("path").transition().duration(1e3).attr("d",a)}function f(){u.translate(d3.event.translate).scale(d3.event.scale);c.selectAll("path").attr("d",a)}$(".overlay, .label, #popover").hide();$(".marker").mouseover(function(){$(".label").hide();$(this).find(".label").show()});$(".overlay, #popover .close").click(function(){$("#popover, .overlay").hide()})}$(".participant-clip-listing .clip-thumbnail").click(function(){$("html, body").scrollTop(0);var e=$(this).data("clip-id");$(this).parents(".participant-clip-listing").addClass("active").siblings().removeClass("active");$("#stage").slideUp().load("/wp/wp-admin/admin-ajax.php",{action:"get_participant_clip",clip_id:e},function(){$("#stage").delay(250).slideDown()})});if($(".blog").length){var y=$(".blog .post").first().data("bg");y&&e(y,{to:"#262626"});$(".past-posts .post").each(function(){var e=$(this).data("bg");e&&$(this).css("background-image","url("+e+")")})}$(".events-list").length&&$(".tribe-events-event").each(function(){var e=$(this).data("bg");e&&$(this).css("background-image","url("+e+")")});$(".search-sidebar :checkbox").change(function(){var e=$(this).val();$(".search-result."+e).slideToggle("",function(){$(".results-found").html($(".search-result:visible").length)})});if($("body.tax-series").length){$(".carousel").carousel("pause");$("#series-carousel").bind("slide",function(){$("#series-carousel").css("overflow","hidden")});$("#series-carousel").bind("slid",function(){$("#series-carousel").css("overflow","visible")});$("#nav-series .participant-thumbnail").click(function(){$("#home").fadeOut("slow");t($(this).data("id"))});$("#nav-series .home-thumbnail").click(function(){$("#stage").fadeOut("slow",function(){$("#home").fadeIn("slow")})});$(".btn-mapview").click(function(){$("#mapview").slideToggle(500)})}});