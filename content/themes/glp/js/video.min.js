$(function(){$(".participant-video-controls").each(function(){var e=$(this).siblings(".participant-video-embed").attr("id");var c=players[e];$("#"+e).bind("player_ready",videoSetTimer);$("#"+e).bind("player_ready",videoUpdateTimer);$("#"+e).bind("player_time_update",videoUpdateTimer);$("#"+e).bind("player_time_update",videoUpdatePosition);var d=$("#"+e).siblings(".participant-video-controls").find(".control-slider").slider({range:"min",min:0,max:1000});$(d).on("slidestop",function(f,g){var h=$(this).closest(".participant-clip").find(".participant-video-embed").attr("id");players[h].seekTo(Math.round((players[h].getDuration()*(g.value/1000))*100)/100,true);$("#"+h).bind("player_time_update",videoUpdatePosition)});$(d).on("slidestart",function(f,g){var h=$(this).closest(".participant-clip").find(".participant-video-embed").attr("id");$("#"+h).unbind("player_time_update",videoUpdatePosition)})});$(".controls").live("click",function(){var f=$(this).closest(".participant-clip").find(".participant-video-embed").attr("id");var c=players[f];var e=$(this).attr("data-control");switch(e){case"play":players[f].playVideo();$(this).attr("data-control","pause").find("span").toggleClass("icon-pause","icon-play");break;case"pause":players[f].pauseVideo();$(this).attr("data-control","play").find("span").toggleClass("icon-pause","icon-play");break;case"fullscreen":var d=document.getElementById(f);if(d.requestFullScreen){d.requestFullScreen()}else{if(d.mozRequestFullScreen){d.mozRequestFullScreen()}else{if(d.webkitRequestFullScreen){d.webkitRequestFullScreen()}}}break}});$(".taggable-area").each(function(){var c=$(this).next().find(".content").html();var d=$(this).next().find(".title").html();$(this).popover({html:true,animation:false,content:c,title:d})}).click(function(i){var c=$(this).closest(".participant-clip").find(".participant-video-embed").attr("id");var l=players[c];var g=parseInt(i.pageX-$(this).offset().left);var j=(g/$(this).width());var k=Math.round((l.getDuration()*j)*100)/100;var d=parseInt(k/60)%60;var n=parseInt(k%60,10);var f=g-($(this).next().width()/2);var h=$(this).next();$(this).data("m",d).data("s",n).data("p",g);$(h).find(".comment-box").prepend($("#marker-"+g+" .content").html());$(h).css("left",f).find(".time").text(d+":"+n);a(h)});$(document).on("click",".popover .close",function(){$(this).closest(".popover").prev().popover("hide")});$(document).on("submit",".popover form",function(){$(this).find(".error").fadeOut("slow",function(){$(this).remove()});$.post(glpAjax.ajaxurl,{action:"clip_submit_comment",comment:$(this).find('input[name="comment"]').val(),minutes:$(".taggable-area").data("m"),seconds:$(".taggable-area").data("s"),position:$(".taggable-area").data("p"),post_id:$(".participant-video-embed").attr("id").replace("participant-video-embed-","")},function(c){r=$.parseJSON(c);$(".comment-box").prepend(r.message).closest("form").find("input").val("");if(r.success){b(r.success,r.message)}a($(".popover"))});return false});function a(c){$(c).css("top",(0-$(c).height()-20))}function b(c,e){var d=$("#marker-"+c);if(d.length){$(d).find(".content").prepend(e)}else{$(".clip-markers").append('<a class="marker" id="marker-'+c+'" style="left: '+c+'px"><div class="arrow"></div><div class="hide content">'+e+"</div></div>")}}});var players={};var t;(function(){var a=document.createElement("script");a.src=(location.protocol=="https:"?"https":"http")+"://www.youtube.com/player_api";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)})();function onYouTubePlayerAPIReady(){YT_ready(true)}function getFrameID(d){var c=document.getElementById(d);if(c){if(/^iframe$/i.test(c.tagName)){return d}var a=c.getElementsByTagName("iframe");if(!a.length){return null}for(var b=0;b<a.length;b++){if(/^https?:\/\/(?:www\.)?youtube(?:-nocookie)?\.com(\/|$)/i.test(a[b].src)){break}}c=a[b];if(c.id){return c.id}do{d+="-frame"}while(document.getElementById(d));c.id=d;return d}return null}var YT_ready=(function(){var b=[],a=false;return function(c,d){if(c===true){a=true;while(b.length){b.shift()()}}else{if(typeof c=="function"){if(a){c()}else{b[d?"unshift":"push"](c)}}}}})();YT_ready(function(){$(".participant-video-embed").each(function(){var a=this.id;var b=getFrameID(a);if(b){players[b]=new YT.Player(b,{events:{onStateChange:onStateChange(b,a),onReady:onReady(b,a)}})}})});function onStateChange(b,a){return function(d){var c=players[b];switch(d.data){case 1:case 3:$("#"+b).trigger("player_start_play_buffer");t=setInterval(function(){playerTimeUpdate(b)},1000);break;case 2:case 0:$("#"+b).trigger("player_pause_end");clearTimeout(t);break}}}function onReady(b,a){return function(e){var d=players[b];var c=!d.cueVideoByFlashvars;if(c&&!d.getDuration()){alert("Youtube html5 detected. Tagging/commenting on this clip won't work until you hit play")}$("#"+b).trigger("player_ready")}}function playerTimeUpdate(a){$("#"+a).trigger("player_time_update")}function videoUpdatePosition(c){var a=players[c.currentTarget.id];var b=$("#"+c.currentTarget.id).siblings(".participant-video-controls").find(".control-slider");$(b).slider("value",(a.getCurrentTime()/a.getDuration())*1000)}function videoUpdateTimer(d){var b=players[d.currentTarget.id];var a=parseInt(b.getCurrentTime()/60)%60;var c=parseInt(b.getCurrentTime()%60,10);$(".control-time-current .time-m").text(a);$(".control-time-current .time-s").text(c)}function videoSetTimer(d){var b=players[d.currentTarget.id];var a=parseInt(b.getDuration()/60)%60;var c=parseInt(b.getDuration()%60,10);$(".control-time-total .time-m").text(a);$(".control-time-total .time-s").text(c)};