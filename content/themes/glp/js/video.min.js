$(function(){$(window).bind("setup_players",setup_players);$(".controls").live("click",function(){var d=$(this).closest(".participant-clip").find(".participant-video-embed").attr("id");var a=players[d];var c=$(this).attr("data-control");switch(c){case"play":players[d].playVideo();break;case"pause":players[d].pauseVideo();break;case"fullscreen":var b=document.getElementById(d);if(b.requestFullScreen){b.requestFullScreen()}else{if(b.mozRequestFullScreen){b.mozRequestFullScreen()}else{if(b.webkitRequestFullScreen){b.webkitRequestFullScreen()}}}break;case"comments":$(".clip-markers").toggle();break}});$(document).on("click",".popover .close",function(){$(this).closest(".popover").prev().popover("hide")});$(document).on("submit",".popover form",function(){$(this).find(".error").fadeOut("slow",function(){$(this).remove()});$.post(glpAjax.ajaxurl,{action:"clip_submit_comment",comment:$(this).find('input[name="comment"]').val(),minutes:$(".taggable-area").data("m"),seconds:$(".taggable-area").data("s"),position:$(".taggable-area").data("p"),post_id:$(".participant-video-embed").attr("id").replace("participant-video-embed-","")},function(a){r=$.parseJSON(a);$(".comment-box").prepend(r.message).closest("form").find("input").val("");if(r.success){add_comment_to_marker_box(r.success,r.message)}popover_fix_height($(".popover"))});return false})});var players={};var t;(function(){var a=document.createElement("script");a.src=(location.protocol=="https:"?"https":"http")+"://www.youtube.com/player_api";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)})();function onYouTubePlayerAPIReady(){YT_ready(true)}function getFrameID(d){var c=document.getElementById(d);if(c){if(/^iframe$/i.test(c.tagName)){return d}var a=c.getElementsByTagName("iframe");if(!a.length){return null}for(var b=0;b<a.length;b++){if(/^https?:\/\/(?:www\.)?youtube(?:-nocookie)?\.com(\/|$)/i.test(a[b].src)){break}}c=a[b];if(c.id){return c.id}do{d+="-frame"}while(document.getElementById(d));c.id=d;return d}return null}var YT_ready=(function(){var b=[],a=false;return function(c,d){if(c===true){a=true;while(b.length){b.shift()()}}else{if(typeof c=="function"){if(a){c()}else{b[d?"unshift":"push"](c)}}}}})();YT_ready(function(){$(window).trigger("setup_players")});function setup_players(){$(".participant-video-embed").each(function(){var a=this.id;var b=getFrameID(a);if(b){players[b]=new YT.Player(b,{events:{onStateChange:onStateChange(b,a),onReady:onReady(b,a)}});$("#"+b).bind("player_ready",videoSetTimer);$("#"+b).bind("player_ready",setup_control_slider);$("#"+b).bind("player_ready",setup_volume_slider);$("#"+b).bind("player_start_play_buffer",videoSetTimer);$("#"+b).bind("player_start_play_buffer",enable_taggable_area);$("#"+b).bind("player_start_play_buffer",display_taggable_area);$("#"+b).bind("player_start_play_buffer",toggle_play_pause_button);$("#"+b).bind("player_pause_end",toggle_play_pause_button);$("#"+b).bind("player_time_update",videoUpdateTimer);$("#"+b).bind("player_time_update",videoUpdatePosition)}})}function onStateChange(b,a){return function(d){var c=players[b];switch(d.data){case 1:case 3:$("#"+b).trigger("player_start_play_buffer");t=setInterval(function(){playerTimeUpdate(b)},1000);break;case 2:case 0:$("#"+b).trigger("player_pause_end");clearTimeout(t);break}}}function onReady(b,a){return function(e){var d=players[b];var c=!d.cueVideoByFlashvars;if(c&&!d.getDuration()){}$("#"+b).trigger("player_ready")}}function playerTimeUpdate(a){$("#"+a).trigger("player_time_update")}function videoUpdatePosition(c){var a=players[c.currentTarget.id];var b=$("#"+c.currentTarget.id).siblings(".participant-video-controls").find(".control-slider");$(b).slider("value",(a.getCurrentTime()/a.getDuration())*1000)}function videoUpdateTimer(d){var b=players[d.currentTarget.id];var a=parseInt(b.getCurrentTime()/60)%60;var c=parseInt(b.getCurrentTime()%60,10);$(".control-time-current .time-m").text(a);$(".control-time-current .time-s").text(c)}function videoSetTimer(d){var b=players[d.currentTarget.id];var a=parseInt(b.getDuration()/60)%60;var c=parseInt(b.getDuration()%60,10);$(".control-time-total .time-m").text(a);$(".control-time-total .time-s").text(c)}function enable_taggable_area(){$(".taggable-area").each(function(){var a=$(this).next().find(".content").html();var b=$(this).next().find(".title").html();$(this).popover({html:true,animation:false,content:a,title:b})}).click(function(g){var a=$(this).closest(".participant-clip").find(".participant-video-embed").attr("id");var j=players[a];var d=parseInt(g.pageX-$(this).offset().left);var h=(d/$(this).width());var i=Math.round((j.getDuration()*h)*100)/100;var b=parseInt(i/60)%60;var k=parseInt(i%60,10);var c=d-($(this).next().width()/2);var f=$(this).next();$(this).data("m",b).data("s",k).data("p",d);$(f).find(".comment-box").prepend($("#marker-"+d+" .content").html());$(f).css("left",c).find(".time").text(b+":"+k);popover_fix_height(f)})}function popover_fix_height(a){$(a).css("top",(0-$(a).height()-20))}function add_comment_to_marker_box(a,c){var b=$("#marker-"+a);if(b.length){$(b).find(".content").prepend(c)}else{$(".clip-markers").append('<a class="marker" id="marker-'+a+'" style="left: '+a+'px"><div class="arrow"></div><div class="hide content">'+c+"</div></div>")}}function display_taggable_area(a){$(".taggable-area").each(function(){$(this).show().find("span").each(function(){$(this).show().delay(1000).fadeOut("slow",function(){$(this).css("display","")})})});$(".clip-markers").show()}function toggle_play_pause_button(b){var a=players[b.currentTarget.id];switch(a.getPlayerState()){case 1:$(".play-pause").attr("data-control","pause").find("span").toggleClass("icon-pause","icon-play");break;case 2:$(".play-pause").attr("data-control","play").find("span").toggleClass("icon-pause","icon-play");break}}function setup_control_slider(b){var a=$("#"+b.currentTarget.id).siblings(".participant-video-controls").find(".control-slider").slider({range:"min",min:0,max:1000});$(a).on("slidestart",function(c,d){var e=$(this).closest(".participant-clip").find(".participant-video-embed").attr("id");$("#"+e).unbind("player_time_update",videoUpdatePosition)});$(a).on("slidestop",function(c,d){var e=$(this).closest(".participant-clip").find(".participant-video-embed").attr("id");players[e].seekTo(Math.round((players[e].getDuration()*(d.value/1000))*100)/100,true);$("#"+e).bind("player_time_update",videoUpdatePosition)})}function setup_volume_slider(c){var a=players[c.currentTarget.id];var b=$("#"+c.currentTarget.id).siblings(".participant-video-controls").find(".volume-slider").slider({orientation:"vertical",range:"min",min:0,max:100,value:a.getVolume()});$(b).on("slide",function(d,e){a.setVolume(e.value)})};