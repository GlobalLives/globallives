var tribe_tickets_ticket_form={};!function(t,e){var _,c;e.init=function(){_=t(".tribe-events-tickets"),c=_.find(".quantity").find(".qty"),c.on("change",e.on_quantity_change)},e.on_quantity_change=function(){var _=t(this),c=e.get_matching_ticket_id(this);e.ticket_uses_global_stock(c)?e.global_stock_quantity_changed(_,c):e.normal_stock_quantity_changed(_,c)},e.global_stock_quantity_changed=function(t,_){var c=t.val(),i=e.get_event_id(_),a=e.get_cap(_),o=e.get_global_stock(i),n=e.currently_requested_global_event_stock(i);n>o&&(c-=n-o),e.stock_mode_is_capped(_)&&c>a&&(c=a),0>=c&&(c=0),t.val(c),e.update_available_stock_counts(i)},e.normal_stock_quantity_changed=function(t,c){var i,a=t.val(),o=e.get_single_stock(c);a>o&&(a=o),t.val(a),i=o-a,_.find(".available-stock[data-product-id="+c+"]").html(i)},e.update_available_stock_counts=function(c){var i=e.get_tickets_of(c),a=e.get_global_stock(c)-e.currently_requested_global_event_stock(c);for(var o in i)if(i.hasOwnProperty(o)){a<0&&(a=0);var n=i[o];if("global"===n.mode&&_.find(".available-stock[data-product-id="+o+"]").html(a),"capped"===n.mode){var r=Math.min(a,n.cap),s=parseInt(t("[data-product-id="+o+"]").find("input").val(),10),d=n.cap-s;d<0?d=0:d>r&&(d=r),_.find(".available-stock[data-product-id="+o+"]").html(d)}}},e.get_matching_ticket_id=function(e){var _=t(e).closest("[data-product-id]");if(_.length)return _.data("product-id")},e.get_ticket_property=function(t,e){if("object"!=typeof tribe_tickets_stock_data)return!1;var _=tribe_tickets_stock_data.tickets[t];return"undefined"!==tribe_tickets_stock_data.tickets[t]&&_[e]},e.get_tickets_of=function(t){if("object"!=typeof tribe_tickets_stock_data)return!1;var e=[];for(var _ in tribe_tickets_stock_data.tickets){var c=tribe_tickets_stock_data.tickets[_];t===c.event_id&&(e[_]=c)}return e},e.currently_requested_global_event_stock=function(t){var c=0,i=e.get_tickets_of(t);for(var a in i)switch(tribe_tickets_stock_data.tickets[a].mode){case"global":case"capped":c+=parseInt(_.find("[data-product-id="+a+"]").find(".qty").val(),10)}return c},e.get_event_property=function(t,e){if("object"!=typeof tribe_tickets_stock_data)return!1;var _=tribe_tickets_stock_data.events[t];return"undefined"!==tribe_tickets_stock_data.events[t]&&_[e]},e.stock_mode_is_global=function(t){return"global"===e.get_mode(t)},e.stock_mode_is_capped=function(t){return"capped"===e.get_mode(t)},e.ticket_uses_global_stock=function(t){return e.stock_mode_is_capped(t)||e.stock_mode_is_global(t)},e.get_mode=function(t){return e.get_ticket_property(t,"mode")},e.get_event_id=function(t){return e.get_ticket_property(t,"event_id")},e.get_cap=function(t){return e.get_ticket_property(t,"cap")},e.get_global_stock=function(t){return e.get_event_property(t,"stock")},e.get_single_stock=function(t){return e.get_ticket_property(t,"stock")},t(function(){e.init()})}(jQuery,tribe_tickets_ticket_form);