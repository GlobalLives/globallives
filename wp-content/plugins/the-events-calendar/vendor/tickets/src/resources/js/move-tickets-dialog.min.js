var tribe_move_tickets=tribe_move_tickets||{};!function(t,e){function i(){m=t("#main"),k=t(".error"),u=t("#processing"),y=t("#back"),x=t("#next"),m.trigger("move-tickets-dialog-pre-init.tribe"),y.add(x).hide(),u.hide(),k.length||(x.show(),a()),m.trigger("move-tickets-dialog-post-init.tribe")}function a(){n(),"move_tickets"===tribe_move_tickets_data.mode?(c(),s()):(t("#move-where").remove(),t("#choose-ticket-type").remove()),g=t(".stage"),r(),d(),o(g.first())}function o(t){b=t,h=b.attr("id"),g.hide(),b.show(),m.trigger("pre-activate-stage.tribe"),m.trigger("activate-"+h+".tribe")}function c(){function e(){var t=a.filter(":checked");return t.length?("this-post"===t.val()?(_(tribe_move_tickets_data.src_post_id),j=!0):(C=!1,j=!1),void p(x,i)):void v(x,i)}var i="move-where",a=t('input[name="move-where"]');m.on("activate-move-where.tribe",function(){l(y,i),e()}),a.change(e)}function n(){function e(){r.html('<option value="">'+tribe_move_tickets_data.loading_msg+"</option>");var e={action:"move_tickets_get_post_types",check:tribe_move_tickets_data.check};t.post(ajaxurl,e,function(t){if("undefined"!=typeof t.data&&"object"==typeof t.data.posts){r.html("");for(var e in t.data.posts)r.append('<option value="'+e+'">'+t.data.posts[e]+"</option>")}})}function i(){if(!f){f=!0,s.css("opacity",.6),v(x,l);var e={action:"move_tickets_get_post_choices",check:tribe_move_tickets_data.check,post_type:r.val(),search_terms:d.val(),ignore:tribe_move_tickets_data.src_post_id};t.post(ajaxurl,e,function(t){if("undefined"!=typeof t.data&&"object"==typeof t.data.posts){s.html("");var e=0;for(var i in t.data.posts){var a=parseInt(i,10),o=t.data.posts[i];e++,s.append('<label> <input type="radio" value="'+a+'" name="post-choice">'+o+"</label>")}e||s.append("<label>"+tribe_move_tickets_data.no_posts_found+"</label>"),f=!1,s.css("opacity",1)}})}}function a(){var t=s.find("input:checked");s.find(".selected").removeClass("selected"),t.length&&(_(t.val()),t.parent("label").addClass("selected"),p(x,l))}var c,n=t("#choose-event"),s=n.find(".select-single-container"),r=t("#post-type"),d=t("#search-terms"),l="choose-event",f=!1;m.on("activate-choose-event.tribe",function(){p(y,l),v(x,l),j&&"next"===w?o(b.next()):j&&o(g.first()),a()}),e(),i(),d.keyup(function(){clearTimeout(c),c=setTimeout(i,200)}),r.change(i),s.click(function(){f||a()})}function s(){function e(){var t=c.find("input:checked");c.find(".selected").removeClass("selected"),t.length&&(I=parseInt(t.val()),t.parent("label").addClass("selected"),p(x,i))}var i="choose-ticket-type",a=t("#choose-ticket-type"),c=a.find(".select-single-container");m.on("activate-choose-ticket-type.tribe",function(){p(y,i),v(x,i),C||o(g.first())}),m.on("destination-post-selected.tribe",function(){c.css("opacity",.6),v(x,i);var e={action:"move_tickets_get_ticket_types",check:tribe_move_tickets_data.check,post_id:C,provider:tribe_move_tickets_data.provider,ticket_ids:tribe_move_tickets_data.ticket_ids};t.post(ajaxurl,e,function(t){if("object"==typeof t.data.posts){c.html("");var e=0;for(var i in t.data.posts){var a=parseInt(i,10),o=t.data.posts[i];e++,c.append('<label> <input type="radio" value="'+a+'" name="post-choice">'+o+"</label>")}e||c.append("<label>"+tribe_move_tickets_data.no_ticket_types_found+"</label>"),c.css("opacity",1)}})}),c.click(e)}function r(){function e(t){w=t;var e=b[t](".stage");e.length?o(e):f()&&m.trigger("move-tickets-final-stage.tribe")}var i=x.html(),a=x.data("final-text");a=a?a:i,m.on("pre-activate-stage.tribe",function(){x.html(f()?a:i)}),y.add(x).click(function(){switch(t(this).attr("id")){case"back":e("prev");break;case"next":e("next")}})}function d(){function e(){if(C&&I){var e={action:"move_tickets",src_post_id:tribe_move_tickets_data.src_post_id,target_post_id:C,check:tribe_move_tickets_data.check,ticket_ids:tribe_move_tickets_data.ticket_ids,target_type_id:I};g.hide(),y.hide(),x.hide(),u.show(),t.post(ajaxurl,e,function(t){a(t)}).fail(o)}}function i(){if(C){var e={action:"move_ticket_type",src_post_id:tribe_move_tickets_data.src_post_id,ticket_type_id:tribe_move_tickets_data.ticket_type_id,target_post_id:C,check:tribe_move_tickets_data.check};g.hide(),y.hide(),x.hide(),u.show(),t.post(ajaxurl,e,function(t){a(t)}).fail(o)}}function a(e){if("undefined"==typeof e.data||"string"!=typeof e.data.message)return void o();if(u.html(e.data.message),"string"==typeof e.data.redirect_top){var i="number"==typeof e.data.redirect_top_delay?e.data.redirect_top_delay:2e3;setTimeout(function(){top.location=e.data.redirect_top},i)}"number"==typeof e.data.remove_ticket_type&&top.jQuery("table.ticket_list").find('tr[data-ticket-type-id="'+e.data.remove_ticket_type+'"]').remove(),t.isArray(e.data.remove_tickets)&&top.tribe_event_tickets_attendees.remove_tickets(e.data.remove_tickets)}function o(){u.html(tribe_move_tickets_data.unexpected_failure)}m.on("move-tickets-final-stage.tribe",function(){switch(tribe_move_tickets_data.mode){case"move_tickets":e();break;case"ticket_type_only":i()}})}function _(t){t=parseInt(t,10),t>0&&C!==t&&(C=t,m.trigger("destination-post-selected.tribe"))}function p(t,e){e===h&&(t.removeProp("disabled").show().removeClass("disabled"),"next"===t.attr("id")&&f()&&t.addClass("button-primary"))}function v(t,e){e===h&&t.prop("disabled",!0).addClass("disabled").removeClass("button-primary")}function l(t,e){e===h&&t.hide()}function f(){return!b.next(".stage").length}var m,u,k,b,h,g,y,x,w,j,C,I;e.get_main_element=function(){return m},e.hide_btn=l,e.disable_btn=v,e.enable_btn=p,e.activate_stage=o,t(document).ready(i)}(jQuery,tribe_move_tickets);