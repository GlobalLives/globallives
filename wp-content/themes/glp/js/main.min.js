$(function(){function e(e,t){var n="rgba(0,0,0,0)",r="rgba(0,0,0,0)",i=new Image;if(t){n=t.from?t.from:n;r=t.to?t.to:r}i.src=e;i.onload=function(){var e="("+n+" 0, "+r+" "+this.height+"px)",t="url("+this.src+")";if(i.src){$("#wrap").css("background-image","-webkit-linear-gradient"+e+", "+t);$("#wrap").css("background-image","-moz-linear-gradient"+e+", "+t);$("#wrap").css("background-image","linear-gradient"+e+", "+t)}}}function t(e){$("#stage").fadeOut("slow").load(glpAjax.ajaxurl,{action:"get_participant_summary",post_id:e},function(){$("#stage").fadeIn("slow");$(window).trigger("setup_players");s()})}function n(e,t){var n=$("#mapview").width(),r=$(t).position().top,i=$(t).position().left;i<n/2?dx_offset=30:dx_offset=-340;$("#popover").attr("data-participant_id",e.id);$("#popover").css("top",r).css("left",i+dx_offset);$("#popover .popover-name").text(e.name);$("#popover .popover-occupation").text(e.occupation);$("#popover .popover-location").text(e.location);$("#popover .popover-gender").text(e.gender_label);$("#popover .popover-income").text(e.income_label);$("#popover .popover-age").text(e.age_label);$("#popover .popover-series").html(e.series_labels||"");$("#popover .popover-themes").html(e.theme_labels||"");$("#popover .popover-thumbnail").attr("src",e.thumbnail);$("#popover .popover-permalink").attr("href",e.permalink);$("#popover").show();$(".popover-series a").on("mouseenter",{taxonomy:"series",participant:e.id},w);$(".popover-themes a").on("mouseenter",{taxonomy:"themes",participant:e.id},w);$(".popover-series a, .popover-themes a").on("mouseleave",S)}function r(e){$(".mapthumb").hide();$("#mapthumb-"+e).show()}function i(e){var t=0;e.each(function(){var e=$(this).height();e>t&&(t=e)});e.height(t)}function s(){var e="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-510832576c1fd9d6";if(window.addthis){window.addthis=null;window._adr=null;window._atc=null;window._atd=null;window._ate=null;window._atr=null;window._atw=null}$.getScript(e)}function o(e){$(".view").slideUp(500,function(){$(e).delay(700).slideDown(500);$(".btn-"+e.substring(1)).addClass("active").siblings().removeClass("active")});window.location.hash=e}$("a:has(img)").addClass("image-link");i($("#nav-modules .widget"));$("input.copyable").click(function(){$(this).select()});if($("body.page-home").length){$(".carousel").carousel("pause");$("#featured-carousel").bind("slide",function(){$("#featured-carousel").css("overflow","hidden")});$("#featured-carousel").bind("slid",function(){$("#featured-carousel").css("overflow","visible")});$("#nav-featured .participant-thumbnail").popover();$("#nav-featured .participant-thumbnail").click(function(){$(".home-thumbnail, .participant-thumbnail").removeClass("active");$(this).addClass("active");$("#home").fadeOut("slow");t($(this).data("id"))});$("#nav-featured .home-thumbnail").click(function(){$("#stage").fadeOut("slow",function(){$(".participant-thumbnail").removeClass("active");$(".home-thumbnail").addClass("active");$("#home").fadeIn("slow")})})}if($("body.page-explore").length){var u=window.location.hash;(u==="#mapview"||u==="#gridview")&&o(u);$(".btn-mapview").click(function(){o("#mapview")});$(".btn-gridview").click(function(){o("#gridview")});$("#nav-explore input, #nav-explore select").change(function(){$(participants).each(function(){this.filtered=!1;$("select[name=series]").val()&&$("select[name=series]")!=="All"&&this.series!==$("select[name=series]").val()&&(this.filtered=!0);$("select[name=gender]").val()!=="All"&&this.gender!==$("select[name=gender]").val()&&(this.filtered=!0);$("select[name=income]").val()!=="All"&&this.income!==$("select[name=income]").val()&&(this.filtered=!0);$("select[name=age]").val()!=="All"&&this.age!==$("select[name=age]").val()&&(this.filtered=!0);this.proposed&&(this.filtered=!0);$("input[name=proposed]:checked").val()&&this.proposed&&(this.filtered=!1)});a();return!1})}if($("#nav-themes").length){$("#nav-themes li").click(function(){var e=$(this).attr("data-term");$(participants).each(function(){this.filteredByTheme=!1;e&&$.inArray(e,this.themes)==-1&&(this.filteredByTheme=!0)});a();$(this).addClass("active").siblings().removeClass("active");$(this).siblings().children(".flyup").slideUp();$(this).children(".flyup").slideToggle()});$("#nav-themes .flyup .thumbnails").cycle();function a(){$(participants).each(function(){if(this.filtered===!0||this.filteredByTheme===!0){$("#participant-"+this.id).addClass("filtered");d3.selectAll("#marker-"+this.id).classed("filtered",!0)}else{$("#marker-"+this.id+", #participant-"+this.id).removeClass("filtered");d3.selectAll("#marker-"+this.id).classed("filtered",!1)}})}}if($("#mapview").length){$("#mapview").hide();var f=$("#mapview").height(),l=$("#mapview").width(),c=d3.geo.mercator().scale(l*.16).translate([l/2,f/1.75]),h=d3.geo.path().projection(c),p=d3.behavior.zoom().translate(c.translate()).scale(c.scale()).scaleExtent([l*.15,8*f]).on("zoom",function(){c.translate(d3.event.translate).scale(d3.event.scale);v.selectAll("path").attr("d",h);d.selectAll(".marker").attr("transform",function(e){return"translate("+c([+e.longitude,+e.latitude])+")"})}),d=d3.select("#mapview").append("svg").attr("height",f).attr("width",l),v=d.append("g").attr("id","countries").call(p);v.append("rect").attr("class","background").attr("height",f).attr("width",l);var m=d.append("g").attr("id","underlay"),g=d.append("defs").selectAll("thumbnails").data(participants).enter().append("pattern").attr("id",function(e,t){return"image-"+t}).attr("patternUnits","objectBoundingBox").attr("width",50).attr("height",50).append("image").attr("xlink:href",function(e){return e.thumbnail}).attr("x",0).attr("y",0).attr("width",50).attr("height",50),y=d.selectAll(".marker").data(participants).enter().append("g").attr("id",function(e){return"marker-"+e.id}).attr("class",function(e){return"marker "+e.continent}).attr("transform",function(e){return"translate("+c([+e.longitude,+e.latitude])+")"}).attr("data-x",function(e){var t=c([+e.longitude,+e.latitude]);return Math.round(t[0])}).attr("data-y",function(e){var t=c([+e.longitude,+e.latitude]);return Math.round(t[1])}).on("click",function(e){n(e,this)});y.append("path").attr("class","pin").attr("d","M57.985,10.349C51.311,3.675,42.437,0,32.999,0S14.688,3.675,8.014,10.349 C-2.404,20.768-2.666,36.536,7.236,57.217c2.729,5.703,8.621,17.436,13.083,26.275c2.442,4.84,4.722,9.337,6.39,12.624l1.989,3.915 c1.033,2.031,1.849,3.635,4.303,3.635c1.505,0,2.882-0.844,3.564-2.186c0.17-0.333,16.989-33.382,22.198-44.264 C68.664,36.536,68.403,20.768,57.985,10.349z M32.999,45.667c-7.548,0-13.667-6.119-13.667-13.667s6.119-13.667,13.667-13.667 c7.548,0,13.667,6.119,13.667,13.667S40.547,45.667,32.999,45.667z").attr("transform","translate(-8,-24), scale(0.25)");y.append("circle").attr("class","mapthumb").attr("id",function(e,t){return"mapthumb-"+t}).attr("r",25).attr("cy",-25).attr("fill",function(e,t){return"url(#image-"+t+")"});var b=y.append("text").attr("class","label").attr("dx",-25).attr("dy",18);b.append("tspan").attr("class","name").text(function(e){return e.name});b.append("tspan").attr("class","occupation").text(function(e){return e.occupation}).attr("x",-25).attr("dy",18);b.append("tspan").attr("class","location").text(function(e){return e.location}).attr("x",-25).attr("dy",18);d3.json("/wp-content/themes/glp/js/vendor/countries.json",function(e){v.selectAll("path").data(e.features).enter().append("svg:path").attr("d",h)});$(".overlay, .mapthumb, .label, #popover").hide();$(".marker").on("mouseenter",function(){$(".mapthumb, .label").hide();$(this).find(".mapthumb, .label").show();$("#popover").is(":visible")&&E(this)});$(".background, #popover .close").click(function(){$("#popover, .overlay").hide();S()});$(".background").click(function(){$(".mapthumb, .label").hide()});function w(e){S();if($(this).children(".flyup").length)var t=$(this).attr("data-term");else{var t=$(this).attr("href");t=t.split("/").slice(-2)[0]}var n=d.select("#marker-"+e.data.participant),r=[+n.attr("data-x"),+n.attr("data-y")];$(participants).each(function(){if($.inArray(t,this[e.data.taxonomy])>-1){var n=m.select("#marker-"+this.id);n.append("line").attr("class","edge").attr("x1",0).attr("y1",0).attr("x2",function(e){var t=c([+e.longitude,+e.latitude]);return r[0]-t[0]}).attr("y2",function(e){var t=c([+e.longitude,+e.latitude]);return r[1]-t[1]}).style("stroke","#fff").style("stroke-width",2)}})}function E(e){S();var t=$("#popover").attr("data-participant_id")||$("article.participant").attr("data-participant_id"),n=$(e).attr("id").split("-"),r=$.grep(participants,function(e){return e.id==t}),i=$.grep(participants,function(e){return e.id==n[1]});if(t&&n!==t){var s=$.grep(r[0].themes,function(e){return $.inArray(e,i[0].themes)>-1});if(s.length>0){var o=d.select("#marker-"+t),u=d.select("#marker-"+n[1]),a=[+o.attr("data-x"),+o.attr("data-y")],f=[+u.attr("data-x"),+u.attr("data-y")],l=m.append("line").attr("class","edge").attr("x1",a[0]).attr("y1",a[1]).attr("x2",f[0]).attr("y2",f[1]).style("stroke","#fff").style("stroke-width",2),c=m.append("text").attr("class","label").attr("x",(a[0]+f[0])/2).attr("y",(a[1]+f[1])/2).style("fill","#fff");$.each(s,function(e,t){c.append("tspan").attr("class","theme").text(function(){return t}).attr("x",(a[0]+f[0])/2).attr("dx",0).attr("dy",18)})}}}function S(){d.selectAll(".edge, .label").remove()}}if($(".blog").length){var x=$(".blog .post").first().data("bg");x&&e(x,{to:"#262626"});$(".past-posts .post").each(function(){var e=$(this).data("bg");e&&$(this).css("background-image","url("+e+")")})}$(".events-list").length&&$(".tribe-events-event").each(function(){var e=$(this).data("bg");e&&$(this).css("background-image","url("+e+")")});$(".search-sidebar :checkbox").change(function(){var e=$(this).val();$(".search-result."+e).slideToggle("",function(){$(".results-found").html($(".search-result:visible").length)})});if($("body.tax-series").length){$(".carousel").carousel("pause");$("#series-carousel").bind("slide",function(){$("#series-carousel").css("overflow","hidden")});$("#series-carousel").bind("slid",function(){$("#series-carousel").css("overflow","visible")});$("#nav-series .participant-thumbnail").click(function(){$("#home").fadeOut("slow");t($(this).data("id"))});$("#nav-series .home-thumbnail").click(function(){$("#stage").fadeOut("slow",function(){$("#home").fadeIn("slow")})});$(".btn-mapview").click(function(){$("#mapview").slideToggle(500)})}$("body.tax-themes").length&&$("#theme-select").change(function(){console.log("changed themes");window.location="/themes/"+$(this).val()});if($("body.single-participant").length){var T=$("article.participant").attr("data-participant_id");$("#nav-themes").hide();$(".participant-detail-map .handle .btn").click(function(){$("#mapview, #nav-themes").slideToggle();$(".participant-detail-map .handle .btn span").toggle()});$("#nav-themes li").on("click",{taxonomy:"themes",participant:T},w)}if($("#donate-banner").length){var N=$("#donate-banner");N.delay(1e3).slideDown(2e3);$(".not-now").click(function(){N.slideUp(2e3)})}});